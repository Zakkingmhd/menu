<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0">
<title>Eazeo | Find Food</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Plus Jakarta Sans', sans-serif; background: #FAFAFA; -webkit-tap-highlight-color: transparent; }
  .glass { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(0,0,0,0.05); }
  .loader { border: 3px solid #f3f3f3; border-top: 3px solid #3b82f6; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; margin: 20px auto; }
  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
</style>
</head>
<body class="pb-24">

  <div class="glass sticky top-0 z-50 px-6 py-4 flex justify-between items-center transition-all duration-300" id="navbar">
    <h1 class="text-2xl font-extrabold tracking-tight text-slate-900">Eazeo<span class="text-blue-600">.</span></h1>
    <span class="text-[10px] bg-slate-100 text-slate-500 px-3 py-1.5 rounded-full font-bold uppercase tracking-wider">Beta</span>
  </div>

  <div class="px-6 py-8 bg-white">
    <h2 class="text-3xl font-extrabold text-slate-900 leading-tight">Find local <br><span class="text-blue-600">favorites.</span></h2>
    
    <div class="mt-6 relative group">
      <input id="q" type="text" placeholder="Search dishes (e.g. Porotta, Tea)..." class="w-full p-4 pl-12 rounded-2xl border border-slate-100 bg-slate-50 text-lg focus:bg-white focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all outline-none shadow-sm">
      <div class="absolute left-4 top-4 text-slate-400 group-focus-within:text-blue-500 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
      </div>
    </div>
  </div>

  <div id="loading" class="loader" style="display:none;"></div>
  <div id="results" class="px-5 space-y-3">
    <div class="text-center py-20 text-slate-400 select-none">
      <p class="text-sm font-medium">Type a dish to explore menus</p>
    </div>
  </div>

  <script>
    let items = [];
    const loader = document.getElementById("loading");

    // ⚡️ Fisher-Yates Shuffle for Fairness
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // Load Data
    fetch("restaurants.json")
      .then(r => r.json())
      .then(async restos => {
        // Randomize fetch order so no restaurant is favored
        const shuffledRestos = shuffleArray([...restos]);
        
        // Show loader if slow
        // loader.style.display = 'block';

        const promises = shuffledRestos.map(r => 
          fetch(`https://opensheet.elk.sh/${r.sheetId}/menu`)
            .then(x => x.json())
            .then(data => {
              data.filter(i => i.Status === "Available").forEach(i => {
                items.push({ 
                  name: i.Item, 
                  resto: r.name, 
                  restoId: r.id 
                });
              });
            })
            .catch(err => console.error(`Failed to load ${r.name}`, err))
        );

        await Promise.all(promises);
        // loader.style.display = 'none';
      });

    // Search Logic
    document.getElementById("q").oninput = e => {
      const q = e.target.value.toLowerCase().trim();
      const out = document.getElementById("results");
      
      if(!q) { 
        out.innerHTML = '<div class="text-center py-20 text-slate-400"><p class="text-sm font-medium">Type a dish to explore menus</p></div>'; 
        return; 
      }
      
      // Filter items (they are already randomly populated)
      const res = items.filter(i => i.name.toLowerCase().includes(q));
      
      if(res.length === 0) {
        out.innerHTML = '<div class="text-center py-10 text-slate-400">No dishes found.</div>';
        return;
      }

      // Render Results
      out.innerHTML = res.map(i => `
        <div onclick="location.href='resto.html?rid=${i.restoId}'" class="bg-white p-5 rounded-2xl border border-slate-100 flex justify-between items-center active:scale-[0.98] transition-all cursor-pointer shadow-sm hover:shadow-md">
          <div>
            <h4 class="font-bold text-slate-900 text-[17px]">${i.name}</h4>
            <div class="flex items-center gap-2 mt-1.5">
               <span class="text-blue-600 bg-blue-50 px-2 py-0.5 rounded text-xs font-bold uppercase tracking-wide">${i.resto}</span>
            </div>
          </div>
          <div class="text-slate-300">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18l6-6-6-6"/></svg>
          </div>
        </div>
      `).join('');
    };
  </script>
</body>
</html>
