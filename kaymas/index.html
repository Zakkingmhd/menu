<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kaymas Restaurant</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Inter', sans-serif;
      background: #f6f8fa;
      margin: 0;
      color: #1c1e21;
    }

    header {
      text-align: center;
      padding: 1.2rem 1rem;
      background: #ffffff;
      box-shadow: 0 1px 4px rgba(0,0,0,0.05);
    }

    .category-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      padding: 1rem;
      background: #fff;
      position: sticky;
      top: 0;
      z-index: 99;
    }

    .category-buttons button {
      padding: 8px 16px;
      font-size: 0.95rem;
      border-radius: 24px;
      background: #e0f2fe;
      color: #0369a1;
      border: none;
      font-weight: 600;
      cursor: pointer;
    }

    .category-buttons button.active {
      background: #0284c7;
      color: white;
    }

    .category-title {
      font-size: 1.4rem;
      font-weight: 600;
      text-align: center;
      margin: 1.2rem 0 0.6rem;
    }

    .menu-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1.5rem;
      padding: 0 1rem 2rem;
    }

    .menu-item {
      background: #fff;
      border-radius: 16px;
      padding: 1.2rem;
      box-shadow: 0 2px 12px rgba(0,0,0,0.04);
    }

    .item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .item-name {
      font-size: 1.1rem;
      font-weight: 600;
    }

    .item-description {
      font-size: 0.9rem;
      color: #555;
      margin: 0.6rem 0;
    }

    .variant-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 8px;
    }

    .variant-btn {
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid #ccc;
      background: #f1f5f9;
      cursor: pointer;
      font-size: 0.85rem;
    }

    .variant-btn.active {
      background: #0284c7;
      color: white;
      border-color: #0284c7;
    }

    .quantity-controls {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .quantity-btn {
      padding: 4px 12px;
      border: 1px solid #ccc;
      border-radius: 6px;
      background: #f0f0f0;
      cursor: pointer;
    }

    .order-btn {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
    }

    .cart-summary {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #fff;
      border-top: 1px solid #e5e7eb;
      padding: 12px 20px;
      display: none;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
    }

    .cart-summary.show {
      display: flex;
    }

    .checkout-btn {
      background: #10b981;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .footer {
      text-align: center;
      font-size: 0.9rem;
      padding: 1.5rem 0;
      background: #f1f5f9;
    }
  </style>
</head>

<body>

<header>
  <h1 id="restaurantName">Kaymas Restaurant</h1>
  <p>Order directly on WhatsApp</p>
</header>

<div style="text-align:center; margin-top:1rem;">
  <input
    type="text"
    id="searchInput"
    placeholder="Search for dishes..."
    style="width:80%; max-width:500px; padding:10px; border-radius:8px; border:1px solid #ccc; font-size:1rem;">
</div>

<div class="category-buttons" id="categoryButtons"></div>
<div id="menuSection">Loading menu…</div>

<div class="cart-summary" id="cartSummary">
  <div>Total: ₹<span id="cartTotal">0</span></div>
  <button class="checkout-btn" onclick="checkout()">Order on WhatsApp</button>
</div>

<div class="footer">
  Powered by Eazeo
</div>

<script>
/* ================= CONFIG ================= */

const MENU_URL = "https://opensheet.elk.sh/1Nl9H971-1sDglNflUcB4NsdWxTc6YrpoYd0kwPL-0I8/menu";
const RESTAURANT_NAME = "Kaymas Restaurant";
const WHATSAPP_NUMBER = "919744103674";

/* ========================================= */

document.getElementById("restaurantName").innerText = RESTAURANT_NAME;

let cart = {};
let categories = {};
let total = 0;

/* Helpers */
function extractPrice(p) {
  if (!p) return null;
  return parseInt(p.replace("₹","").split("/")[0]);
}

function buildVariants(row) {
  const v = [];
  if (row["Price (Full)"]) v.push({ label:"Full", price:extractPrice(row["Price (Full)"]) });
  if (row["Price (Half)"]) v.push({ label:"Half", price:extractPrice(row["Price (Half)"]) });
  if (row["Price (Quarter)"]) v.push({ label:"Quarter", price:extractPrice(row["Price (Quarter)"]) });
  return v;
}

/* Fetch + normalize */
fetch(MENU_URL)
  .then(res => res.json())
  .then(raw => {
    raw
      .filter(r => r.Status === "Available")
      .map(r => ({
        name: r.Item,
        category: r.Category,
        variants: buildVariants(r),
        description: r.Tags || ""
      }))
      .forEach(item => {
        if (!categories[item.category]) categories[item.category] = [];
        categories[item.category].push(item);
      });

    renderCategoryButtons();
    renderAllCategories();
  });

/* Category UI */
function renderCategoryButtons() {
  const c = document.getElementById("categoryButtons");
  c.innerHTML = "";

  const all = document.createElement("button");
  all.textContent = "All";
  all.classList.add("active");
  all.onclick = () => { setActive("All"); renderAllCategories(); };
  c.appendChild(all);

  Object.keys(categories).forEach(cat => {
    const b = document.createElement("button");
    b.textContent = cat;
    b.onclick = () => { setActive(cat); renderSingleCategory(cat); };
    c.appendChild(b);
  });
}

function setActive(name) {
  document.querySelectorAll(".category-buttons button").forEach(b =>
    b.classList.toggle("active", b.textContent === name)
  );
}

/* Rendering */
function renderAllCategories() {
  const s = document.getElementById("menuSection");
  s.innerHTML = "";
  Object.entries(categories).forEach(([cat, items]) => {
    s.appendChild(buildCategory(cat, items));
  });
}

function renderSingleCategory(cat) {
  const s = document.getElementById("menuSection");
  s.innerHTML = "";
  s.appendChild(buildCategory(cat, categories[cat]));
}

function buildCategory(title, items) {
  const d = document.createElement("div");
  d.innerHTML = `<div class="category-title">${title}</div>`;
  const g = document.createElement("div");
  g.className = "menu-grid";

  items.forEach(item => {
    const card = document.createElement("div");
    card.className = "menu-item";
    card.dataset.item = item.name;

    const variantBtns = item.variants.map(v =>
      `<button class="variant-btn" onclick="selectVariant('${item.name}','${v.label}',${v.price},this)">
        ${v.label} ₹${v.price}
      </button>`
    ).join("");

    card.innerHTML = `
      <div class="item-header">
        <div class="item-name">${item.name}</div>
      </div>
      <div class="item-description">${item.description}</div>
      <div class="variant-buttons">${variantBtns}</div>
      <div class="quantity-controls">
        <button class="quantity-btn" onclick="changeQty('${item.name}',-1)">-</button>
        <span class="quantity-display">0</span>
        <button class="quantity-btn" onclick="changeQty('${item.name}',1)">+</button>
        <button class="order-btn" onclick="addToCart('${item.name}')">Add</button>
      </div>
    `;
    g.appendChild(card);
  });

  d.appendChild(g);
  return d;
}

/* Cart logic */
function selectVariant(name, label, price, el) {
  cart[name] = cart[name] || { qty:0 };
  cart[name].variant = label;
  cart[name].price = price;

  el.parentElement.querySelectorAll(".variant-btn").forEach(b => b.classList.remove("active"));
  el.classList.add("active");
}

function changeQty(name, d) {
  const el = document.querySelector(`[data-item='${name}'] .quantity-display`);
  el.textContent = Math.max(0, parseInt(el.textContent) + d);
}

function addToCart(name) {
  if (!cart[name] || !cart[name].variant) {
    alert("Please select Full / Half / Quarter");
    return;
  }
  const q = parseInt(document.querySelector(`[data-item='${name}'] .quantity-display`).textContent);
  if (q > 0) cart[name].qty = q;
  else delete cart[name];
  updateCart();
}

function updateCart() {
  total = Object.values(cart).reduce((s,i)=>s + i.qty*i.price,0);
  document.getElementById("cartTotal").innerText = total;
  document.getElementById("cartSummary").classList.toggle("show", total > 0);
}

/* Checkout */
function checkout() {
  let msg = `Order from ${RESTAURANT_NAME}%0A`;
  Object.entries(cart).forEach(([n,d]) => {
    msg += `${d.qty} x ${n} (${d.variant}) - ₹${d.qty*d.price}%0A`;
  });
  msg += `%0ATotal: ₹${total}`;
  window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${msg}`, "_blank");
}

/* Search */
document.getElementById("searchInput").addEventListener("input", function() {
  const q = this.value.toLowerCase();
  const s = document.getElementById("menuSection");
  s.innerHTML = "";
  let found = false;

  Object.entries(categories).forEach(([cat, items]) => {
    const f = items.filter(i => i.name.toLowerCase().includes(q));
    if (f.length) {
      found = true;
      s.appendChild(buildCategory(cat, f));
    }
  });

  if (!found) {
    s.innerHTML = `<div style="text-align:center;color:#999;margin-top:2rem;">No results found</div>`;
  }
});
</script>

</body>
</html>
